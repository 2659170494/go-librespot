# ç¼–è¯‘æ–¹æ³•
é¦–å…ˆï¼Œå¦‚æœä½ æ˜¯åœ¨Github Codespaceä¸‹è¿è¡Œæœ¬é¡¹ç›®çš„è¯ï¼Œ
ä½ å¯ä»¥åœ¨æœ¬ç›®å½•è¿è¡Œ`sudo bash ./install-JDK-Android-SDK.sh`è‡ªåŠ¨å®‰è£…å¹¶è®¾ç½®Android SDK & JDKè¿˜æœ‰Android NDKã€‚

å¦åˆ™ï¼Œä½ éœ€è¦è‡ªå·±æ‰‹åŠ¨é…ç½®è¿™äº›ï¼Œç„¶åè®¾ç½®ç¯å¢ƒå˜é‡ï¼š
`export ANDROID_SDK_ROOT=<ä½ çš„Android SDKç¯å¢ƒ> && export ANDROID_HOME=<ä½ çš„Android SDKç¯å¢ƒ> && export JAVA_HOME=<ä½ çš„JDKç¯å¢ƒ>`

å½“ä½ é…ç½®å®Œæˆåï¼Œå³å¯è¿è¡Œ`./start.sh`å¼€å§‹è‡ªåŠ¨ç¼–è¯‘ç¨‹åºã€‚

åœ¨start.shä¸­ï¼Œå®ƒä¼šè‡ªåŠ¨ç¼–è¯‘ä¸¤ç§å¹³å°çš„ç¨‹åºã€‚**ç¬¬ä¸€ç§æ˜¯arm32ä½çš„linux(TARGET=arm-linux-gnueabihf)ï¼Œç¬¬äºŒç§æ˜¯arm32ä½çš„android(AD_TARGET=arm-linux-androideabi)**

è¦æ³¨æ„çš„æ˜¯ï¼Œstart.shé»˜è®¤ç¼–è¯‘çš„æ˜¯arm32ä½å®‰å“ï¼Œå¦‚æœä½ éœ€è¦ç¼–è¯‘arm64ä½å®‰å“ï¼Œåˆ™éœ€è¦å°† **ç¬¬äºŒç§å¹³å°\(å¸¦æœ‰AD\_TARGETå˜é‡\)** çš„å˜é‡ä¿®æ”¹æˆï¼š
```
export AD_TARGET=aarch64-linux-android
export T_AD_TARGET=aarch64-linux-android
export GOARCH=arm64
export GOARM=""
export GOOUTSUFFIX=-aarch64_android
```
åä¹‹arm32ä½å®‰å“çš„å˜é‡æ˜¯ï¼š
```
export AD_TARGET=arm-linux-androideabi
export T_AD_TARGET=armv7a-linux-androideabi
export GOARCH=arm
export GOARM=6 
export GOOUTSUFFIX=-armv6_android
```
**è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå¦‚æœä½ éœ€è¦åœ¨Termuxä¸‹è¿è¡Œï¼Œé‚£ä¹ˆä½ çš„ç¼–è¯‘æ¶æ„å¿…é¡»å’Œä½ çš„æ‰‹æœºæ¶æ„ä¸€è‡´ã€‚å¦åˆ™ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºåªèƒ½åœ¨`adb shell`ä½¿ç”¨**

å½“ä½ ç¼–è¯‘å®Œæˆåï¼Œæœ¬ç›®å½•ä¸‹ä¼šå‡ºç°srcå’Œtmpç›®å½•ã€‚srcç›®å½•åŒ…å«ç¼–è¯‘çš„äºŒè¿›åˆ¶ç›¸å…³æ–‡ä»¶ï¼Œè€ŒtmpåŒ…å«åŠ¨æ€åº“ç›¸å…³æ–‡ä»¶ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦ï¼Œè‡ªè¡Œå¯¼å‡ºéœ€è¦çš„æ–‡ä»¶ã€‚

ç¼–è¯‘å¥½çš„ç¨‹åºå°±åœ¨`./src`ä¸‹ï¼Œå¦‚æœä½ æ²¡æœ‰ä¿®æ”¹è¿‡start.shçš„T_AD_TARGETæˆ–T_TARGETå˜é‡çš„è¯ï¼Œé»˜è®¤`go-librespot-armv6_android`æ˜¯32ä½å®‰å“çš„äºŒè¿›åˆ¶ç¨‹åºï¼Œ`go-librespot-armv6`æ˜¯32ä½linuxçš„äºŒè¿›åˆ¶ç¨‹åº

è€ŒäºŒè¿›åˆ¶çš„åŠ¨æ€åº“åœ¨`./tmp/deps/<ä½ ç¼–è¯‘çš„å¹³å°>/lib`ä¸‹ï¼Œæœ€ä½³å»ºè®®å°±æ˜¯å¯¼å‡º`libogg.so`å’Œ`libasound.so`ã€‚

å‡ºäºALSA-libåŸå› ï¼Œå¦‚æœä½ éœ€è¦å¯¼å‡º`libasound.so`çš„è¯ï¼Œä½ è¿˜éœ€è¦åœ¨`./tmp/deps/<ä½ ç¼–è¯‘çš„å¹³å°>/share/alsa`ä¸‹å¯¼å‡º`alsa.conf`ï¼Œå®ƒå°†ä¼šæ­é…ç¯å¢ƒå˜é‡`ALSA_CONFIG_PATH`ä½¿ç”¨

## ä½¿ç”¨æ–¹æ³•ï¼ˆå®‰å“ï¼‰

å½“ä½ å¯¼å‡ºå¥½ä½ éœ€è¦çš„æ–‡ä»¶çš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥å¼€å§‹æ¥ä¸‹æ¥çš„å·¥ä½œäº†ã€‚

å°†ä½ çš„ç¨‹åºè¿˜æœ‰åŠ¨æ€åº“æ–‡ä»¶å¤åˆ¶åˆ°ä½ çš„æ‰‹æœºï¼Œå¹¶è®°å½•å¥½å®ƒä»¬çš„ä½ç½®ã€‚

å¦‚æœä½ ä¸æ‰“ç®—ç”¨termuxè¿è¡Œçš„è¯ï¼ˆæœ¬æ¡ˆä¾‹å›´ç»•`adb shell`å±•å¼€ï¼‰ï¼Œæˆ‘ä¸ªäººæ¨èå°†ç¨‹åºå’ŒåŠ¨æ€åº“æ–‡ä»¶ä»¥åŠé…ç½®æ–‡ä»¶éƒ½å¤åˆ¶åˆ°`/data/local/tmp/`

å¦‚æœä½ å¯¼å‡ºäº†ä¸Šé¢çš„æ‰€éœ€çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ åº”è¯¥ä¼šæ‹¥æœ‰`go-librespot-armv6_android`(ç¨‹åºæœ¬ä½“)ã€`libogg.so`(liboggåŠ¨æ€åº“ï¼Œtermuxä¸‹å¯é€‰)ã€`libasound.so`(alsa-libåŠ¨æ€åº“ï¼Œtermuxä¸‹å¯é€‰)ã€`alsa.conf`(alsa-libé…ç½®æ–‡ä»¶ï¼Œæ‹¥æœ‰alsa-libæ—¶æ‰éœ€è¦)

ä¹‹åï¼Œåœ¨ä½ çš„ç»ˆç«¯é‡Œè®¾ç½®`LD_LIBRARY_PATH`ç¯å¢ƒå˜é‡ï¼ˆä¾‹å¦‚`libogg.so`åœ¨`/data/local/tmp/lib/libogg/`ä¸‹ï¼Œ`libasound.so`åœ¨`/data/local/tmp/lib/libasound/`ä¸‹ã€‚åˆ™æ‰§è¡Œ`export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/data/local/tmp/lib/libogg/:/data/local/tmp/lib/libasound/`ã€‚å¦‚æœ`libogg.so`å’Œ`libasound.so`éƒ½åœ¨`/data/local/tmp/`ä¸‹ï¼Œåˆ™æ‰§è¡Œ`export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/data/local/tmp/`ã€‚ï¼‰

ç„¶åï¼Œè®¾ç½®`ALSA_CONFIG_PATH`ç¯å¢ƒå˜é‡ï¼ˆä¾‹å¦‚ä½ çš„`alsa.conf`ä¿å­˜åœ¨`/data/local/tmp`ç›®å½•ä¸‹ï¼Œåˆ™ä½ éœ€è¦æ‰§è¡Œ`export ALSA_CONFIG_PATH="/data/local/tmp/alsa.conf"`ï¼‰

æœ€åï¼Œè®¾ç½®`XDG_CONFIG_HOME`ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªåœ°æ–¹å°†ä¼šè®¾ç½®go-librespotçš„é…ç½®å­˜æ”¾ä½ç½®ï¼ˆä¾‹å¦‚æ‰§è¡Œ`export XDG_CONFIG_HOME=/data/local/tmp/`ä¹‹åï¼Œgo-librespotçš„é…ç½®å°†ä¼šä¿å­˜åœ¨`/data/local/tmp/go-librespot/`ä¸­ï¼‰

å½“ä¸€åˆ‡éƒ½é…ç½®å¥½åï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œä½ å°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼

**å¦‚æœä½ é‡åˆ°äº†é—®é¢˜ï¼Œä½ å¯ä»¥è‡ªå·±æŸ¥çœ‹æºä»£ç è§£å†³ã€‚**

## å…³äºPulseaudio(å®‰å“ç¯å¢ƒä¸‹çš„å£°éŸ³è¾“å‡º)
ç”±äºå®‰å“é©±åŠ¨ä»¥åŠæƒé™åŸå› ï¼Œ**ALSA-libæ˜¯æ— æ³•åœ¨å®‰å“ç¯å¢ƒä¸‹è¿è¡Œçš„**

å½“ä¸é…ç½®config.ymlçš„æƒ…å†µä¸‹ï¼Œå®‰å“ç¯å¢ƒä¸‹è¿è¡Œç¨‹åºä¼šæç¤ºï¼š
```
!!!ALAS ONLY SUPPORT INSTALLED ALAS DRIVER AND RUNNING PROGRAM IN TERMUX OF ROOT ANDROID DEVICE!!!
!!!IF YOU DONT OR HAVEN'T,PLEASE ADD OR CHANGE "audio_backend" TO "pulseaudio" or "pipe" in $XDG_CONFIG_HOME/go-librespot/config.yml !!!
```

æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨Androidæ’­æ”¾å£°éŸ³ï¼Œæˆ‘ä»¬å°±å¾—å€ŸåŠ©**Termux**äº†ã€‚

é¦–å…ˆï¼Œä½ éœ€è¦ä¸‹è½½å¹¶å®‰è£…ä¸‰ä¸ªè½¯ä»¶ï¼š`Simple Protocol Player`ã€`Termux`å’Œ`Termux:API`ã€‚å…¶ä¸­`Termux:API`å¯ä»¥åœ¨`Termux`çš„è®¾ç½®ä¸­ä¸‹è½½å®‰è£…ï¼Œé¿å…å‡ºç°ç‰ˆæœ¬ä¸åŒ¹é…çš„æƒ…å†µã€‚

å½“ä¸‰ä¸ªè½¯ä»¶éƒ½å®‰è£…æˆåŠŸåï¼Œ**å¼ºçƒˆå»ºè®®ç»™è¿™ä¸‰ä¸ªè½¯ä»¶å…è®¸å…¨éƒ¨æƒé™**ã€‚åœ¨æˆ‘æµ‹è¯•çš„æ—¶å€™æˆ‘å¤§å¤šæ•°éƒ½æ˜¯æŒ‚åœ¨æƒé™è®¾ç½®çš„é—®é¢˜ä¸Šã€‚

ç»™äºˆå¿…è¦çš„æƒé™åï¼Œæ‰“å¼€ä½ çš„Termuxå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…è½¯ä»¶åŒ…ï¼š`pkg install termux-x11 termux-api pulseaudio mplayer mpv`

å®‰è£…æˆåŠŸå**é‡å¯`Termux`**,ä¹‹åæ‰§è¡Œï¼š`export PULSE_SERVER=tcp:127.0.0.1:4713`ã€‚è¿™å°†ä¼šè®¾ç½®é»˜è®¤çš„Pulseaudioè¿æ¥åœ°å€ï¼Œéšåæ‰§è¡Œ`pactl list sources short`ã€‚

**å¦‚æœä½ åœ¨è¿™ä¸€æ­¥æˆ–è€…ä»»æ„æ­¥éª¤**å‡ºç°äº†`Connection failure: Connection refused`ï¼Œåˆ™éœ€è¦å…ˆæ‰§è¡Œ`pulseaudio --start --disallow-exit --exit-idle-time=-1`ï¼Œä¹‹åå†æ‰§è¡Œé‚£æ¡å‘½ä»¤ã€‚

å¦‚æœåˆå‡ºç°äº†`Daemon startup failed`ï¼Œé‚£ä¹ˆæ‰§è¡Œ`pulseaudio -k`ï¼Œç„¶åå†è¯•ä¸€æ¬¡ã€‚

å¦‚æœè¿˜æ˜¯ä¸è¡Œçš„è¯ï¼Œç»ˆææ–¹æ¡ˆå°±æ˜¯å°†æœ¬é¡¹ç›®ä¸­çš„`./hook/pulse/default.pa`å¤åˆ¶åˆ°æ‰‹æœºçš„`/data/data/com.termux/files/usr/etc/pulse/`ï¼Œç„¶åé‡å¯Termuxã€‚ä½†æ˜¯è¿™æ ·åšä¼šè¦†ç›–ä½ åŸå…ˆçš„Pulseaudioçš„é…ç½®ï¼Œä¸è¿‡å¯ä»¥è§£å†³ä½ åœ¨æœ¬ç¯‡æ–‡ç« å¯èƒ½æ— æ³•é‡åˆ°çš„å¥‡æ€ªé—®é¢˜ã€‚å¦‚æœä½ ä¸æƒ³è¿™ä¹ˆåšï¼Œä½ å¯ä»¥è‡ªè¡Œæ‰§è¡Œ`pulseaudio -v &`æˆ–`pulseaudio -vvvv &`æŸ¥çœ‹æ—¥å¿—ï¼ˆä¸€èˆ¬è¿™ç§æƒ…å†µåªå‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡å®‰è£…ä½¿ç”¨çš„æ—¶å€™ï¼Œè¯¦æƒ…è¯·è§ï¼š https://askubuntu.com/questions/225444/how-to-make-pulseaudio-work-again å’Œ https://github.com/CypherpunkArmory/UserLAnd/issues/135 ï¼‰

å½“ä½ æ‰§è¡Œå®Œ`pactl list sources short`ä¹‹åï¼Œä½ èƒ½çœ‹åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²è¢«è¾“å‡ºï¼Œä¸å‡ºæ„å¤–çš„è¯ä½ çš„ç»ˆç«¯å¤§æ¦‚é•¿è¿™æ ·ï¼š
```
~ $ pactl list sources short
0   auto_null.monitor   module-null-sink.c  s16le   2ch 44100Hz IDLE
~ $ â–®
```
**è®°ä½ä¸Šé¢çš„å†…å®¹ï¼Œç„¶åæŒ‰ç…§ä¸‹é¢çš„ä¾‹å­å¯¹æ¯”ä¸Šé¢çš„ä¿¡æ¯ï¼Œè‡ªè¡Œä¿®æ”¹æˆé€‚åˆä½ è®¾å¤‡çš„å‘½ä»¤ã€‚æ¯ä¸ªäººæ‰€é€‚ç”¨çš„å‚æ•°é…ç½®éƒ½æ˜¯ä¸åŒçš„ï¼**
```
export PULSE_SERVER=tcp:127.0.0.1:4713 && pactl load-module module-simple-protocol-tcp rate=44100 format=s16le channels=2 source=auto_null.monitor record=true port=6951 listen=127.0.0.1
```
ä¸æ‡‚çš„è¯ï¼Œä¸Šé¢çš„å‘½ä»¤å¤§æ¦‚å¯¹åº”çš„å†…å®¹æ˜¯è¿™æ ·çš„ï¼š

`
export PULSE_SERVER=tcp:<PulseaudioæœåŠ¡å™¨åœ°å€><:ç«¯å£,é»˜è®¤4713> && pactl load-module module-simple-protocol-tcp rate=<44100Hz> format=<s16le> channels=<2ch> source=<auto_null.monitor> record=true port=6951 listen=127.0.0.1
`

ä¿®æ”¹å®Œæˆåå¹¶æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•å¼‚å¸¸å¹¶ä¸”è¾“å‡ºæ•°å­—çš„è¯å°±æ˜¯æˆåŠŸäº†çš„æ„æ€ï¼š
```
~ $ pactl list sources short
0   auto_null.monitor   module-null-sink.c  s16le   2ch 44100Hz IDLE
~ $ export PULSE_SERVER=tcp:127.0.0.1:4713 && pactl load-module module-simple-protocol-tcp rate=44100 format=s16le channels=2 source=auto_null.monitor record=true port=6951 listen=127.0.0.1
16
~ $ â–®
```

ä¹‹åæ‰“å¼€`Simple Protocol Player`è½¯ä»¶ï¼Œåœ¨`IP Address / Hostname`è¿™ä¸€è¾¹å¡«å…¥`127.0.0.1`ï¼Œæ¥ç€åœ¨`Audio Port`è¿™è¾¹å¡«å…¥`6951`ï¼Œç„¶ååœ¨`Sample Rate`è¿™è¾¹ä½ å¯ä»¥è®¾ç½®æˆè·Ÿä¸Šé¢å‘½ä»¤ä¸€æ ·çš„å‚æ•°(å¯¹åº”æœ¬æ¡ˆä¾‹åˆ™æ˜¯`44100`)ï¼Œä¹‹ååœ¨`Buffer size (in ms)`è¿™è¾¹è®¾ç½®æˆ`200`ï¼Œæœ€åå‹¾é€‰`Performance mode`ï¼Œç‚¹å‡»å¯åŠ¨æŒ‰é’®ã€‚**å¦‚æœå‡ºç°äº†`Unable to stream`ï¼Œè¯·æ£€æŸ¥Termuxæ˜¯ä¸æ˜¯è¢«æ€åå°äº†ï¼Œå¦‚æœæ²¡æœ‰çš„è¯è¯·åœ¨Termuxæ‰§è¡Œ`exit`é€€å‡ºTermuxç„¶åé‡æ–°èµ°ä¸€éè¯¥å°èŠ‚ï¼ˆæ²¡å¿…è¦åœ¨ç»§ç»­ä¸‹å»ï¼Œè¿™ä¸ªæ—¶å€™çš„Pulseaudioç™¾åˆ†ç™¾æ˜¯ä¹±å¥—çš„ï¼Œä¿¡æˆ‘ä½ ä¸ä¼šæƒ³å› ä¸ºè¿™ä¸ªæµªè´¹å‡ ä¸ªå°æ—¶çš„ğŸ˜­ğŸ˜­ğŸ˜­ï¼‰**

**ä¹‹åè®°å¾—é”å®š`Simple Protocol Player`çš„åå°**ï¼Œå¦‚æœä½ çš„æ‰‹æœºæœ‰éŸ³ä¹æ–‡ä»¶ï¼ˆé™¤äº†ç½‘æ˜“äº‘QQéŸ³ä¹ä¹‹ç±»çš„ä¼šå‘˜åŠ å¯†æ ¼å¼ï¼‰çš„è¯ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ`mplayer <éŸ³ä¹æ–‡ä»¶è·¯å¾„>`è¿›è¡Œæµ‹è¯•ï¼Œèƒ½å¬åˆ°å£°éŸ³å°±æ˜¯æˆåŠŸã€‚**ä¸èƒ½çš„è¯ï¼Œåœ¨Termuxæ‰§è¡Œ`exit`é€€å‡ºTermuxç„¶åé‡æ–°èµ°ä¸€éè¯¥å°èŠ‚å§ã€‚**

å½“ç„¶æ²¡æœ‰mplayerçš„è¯ï¼Œé…ç½®`$XDG_CONFIG_HOME/go-librespot/config.yml`ï¼Œå°†`audio_backend`è®¾ç½®ä¸º`pulseaudio`ï¼Œç„¶åè¿è¡Œç¨‹åºï¼Œç›´æ¥è°ƒç”¨ç¨‹åºçš„æ’­æ”¾æ¥å£è¿›è¡Œæµ‹è¯•ä¹Ÿè¡Œã€‚

å‚è€ƒèµ„æ–™ï¼š
```
https://github.com/termux/termux-app/issues/874
https://www.bilibili.com/opus/635423781408473091
https://www.reddit.com/r/termux/comments/162w750/please_help_me_set_up_pulseaudio/
https://www.freedesktop.org/wiki/Software/PulseAudio/Documentation/User/PerfectSetup/
https://askubuntu.com/questions/225444/how-to-make-pulseaudio-work-again
https://github.com/CypherpunkArmory/UserLAnd/issues/135
https://bugs.launchpad.net/ubuntu/+source/pulseaudio/+bug/663019
https://www.freedesktop.org/wiki/Software/PulseAudio/Documentation/User/Modules/
https://askubuntu.com/questions/201780/how-do-i-debug-issues-with-pulse-audio
https://android.stackexchange.com/questions/205576/how-to-play-sound-from-termux-when-using-linux
https://stackoverflow.com/questions/51128790/linux-pipe-audio-to-virtual-microphone-using-pactl
https://stackoverflow.com/questions/43480867/linux-pipe-audio-file-to-microphone-input
https://bkhome.org/news/202111/disable-pulseaudio-idle-exit-and-support-multiple-users.html
https://bbs.archlinux.org/viewtopic.php?id=92851
https://github.com/termux/termux-packages/issues/12289
https://github.com/meefik/linuxdeploy/issues/223#issuecomment-114639940
https://github.com/pelya/pulseaudio-android
```